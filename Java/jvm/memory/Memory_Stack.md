###### Java虚拟机栈 （Java Virtual Machine Stacks）

> 栈帧  

与程序计数器一样，Java 虚拟机栈（Java Virtual Machine Stacks）也是线程私有的，它的生命周期与线程相同。  
每个方法被执行的时候都会同时创建一个栈帧（Stack Frame ），用于存储：局部变量表、操作数栈、动态链接、方法地址等信息。  
每一个方法被调用直至执行完成的过程，就对应着一个栈帧在虚拟机栈中从入栈到出栈的过程。  

- 局部变量表  

局部变量表存放了编译期可知的各种基本数据类型、对象的引用（指针），局部变量表所需的内存空间在编译期间完成分配，    
当进入一个方法时，这个方法需要在栈帧中分配的局部变量表的空间大小是完全确定的，在方法运行期间不会改变。  
在Java 虚拟机规范中，对这个区域规定了两种异常状况：
如果线程请求的栈深度大于虚拟机所允许的深度，将抛出StackOverflowError 异常；
如果虚拟机栈可以动态扩展，当扩展时无法申请到足够的内存时会抛出OutOfMemoryError 异常；  

- 操作数栈  

当一个方法刚执行的时候，这个方法的操作数栈是空的，在方法执行的过程中，会有各种指令进行入栈  和 出栈，  

- 动态链接  
每个栈帧都包含一个指向 运行时常量池 中，该栈帧所属的 方法的 引用，持有这个引用是为了支持方法在调用过程中的动态链接（Dynamic Linking）；  
在Class文件的常量池中存有大量的符号引用，字节码中的方法调用指令就以常量池中指向方法的符号引用作为参数。   
这些符号引用一部分会在类加载阶段或者第一次使用的时候就转化为直接引用，这种转化称为静态解析。  
另外一部分将在每一次运行期间转化为直接引用，这部分称为动态连接。   

- 返回地址  

当一个方法开始执行后，只有两种方式可以退出这个方法：   
第一种方式是执行引擎遇到任意一个方法返回的字节码指令，这时候可能会有返回值传递给上层的方法调用者，  
是否有返回值和返回值的类型将根据遇到何种方法返回指令来决定，这种退出方法的方式称为正常完成出口；  

另外一种退出方式是，在方法执行过程中遇到了异常，并且这个异常没有在方法体内得到处理，  
无论是Java虚拟机内部产生的异常，还是代码中使用throw字节码指令产生的异常，只要在本方法的异常表中没有搜索到匹配的异常处理器，就会导致方法退出，  
这种退出方法的方式称为异常完成出口，一个方法使用异常完成出口的方式退出，是不会给它的上层调用者产生任何返回值的。  

无论采用何种退出方式，在方法退出之后，都需要返回到方法被调用的位置，程序才能继续执行，  
方法返回时可能需要在栈帧中保存一些信息，用来帮助恢复它的上层方法的执行状态。   
一般来说，方法正常退出时，调用者的PC计数器的值可以作为返回地址，栈帧中很可能会保存这个计数器值。   
而方法异常退出时，返回地址是要通过异常处理器表来确定的，栈帧中一般不会保存这部分信息。  

方法退出的过程实际上就等同于把当前栈帧出栈，因此退出时可能执行的操作有：
恢复上层方法的局部变量表和操作数栈，  
把返回值（如果有的话）压入调用者栈帧的操作数栈中，  
调整PC计数器的值以指向方法调用指令后面的一条指令等。  






