#### dvm 与 art 虚拟机运行字节码 问题  
在Android5.0中，ART取代了Dalvik虚拟机；  
● art虚拟机直接执行本地机器码，而Dalvik虚拟机运行的dex字节码需要通过解释器执行；  

安卓运行时从Dalvik虚拟机替换成ART虚拟机，并不要求开发者重新将自己的应用直接编译成目标机器码，应用程序仍然是一个包含dex字节码的apk文件，  
这主要得益于AOT技术，也就是在APK运行之前，就对其包含的Dex字节码进行翻译，得到对应的本地机器指令，于是就可以在运行时直接执行了。  

Dalvik是依靠一个Just-In-Time（JIT）解释器去解释字节码，运行时的代码都需要通过一个解释器在用户的设备上运行，这一机制并不高效，  
但让应用能更容易在不同硬件和架构上运行。  

art应用安装的时候，把dex中的字节码编译成本地机器码，之后每次打开应用，执行的都是本地机器码。  
取掉了运行时的解释执行，效率更高，启动更快。  

所以art占用的内存空间要比dalvik占用的大，大约10-20%用于存储预编译生成的机器码；    
art应用在安装的时候，会比dalvik应用慢一点的；  

#### ART的运行原理：  
在Android系统启动过程中创建的Zygote进程利用ART运行时导出的Java虚拟机接口创建ART虚拟机。  
APK在安装的时候，打包在里面的classes.dex文件会被工具dex2oat翻译成本地机器指令，最终得到一个ELF格式的oat文件。  
APK运行时，上述生成的oat文件会被加载到内存中，并且ART虚拟机可以通过里面的oatdata和oatexec段找到任意一个类的方法对应的本地机器指令来执行，  
oatdata用来生成本地机器指令的dex文件内容，oatexec含有生成的本地机器指令。  

#### JIT 与 AOT  

首先了解JIT（Just In Time，即时编译技术）和AOT(Ahead Of Time，预编译技术)两种编译模式。  
最早的时候，javac把程序源码编译成JAVA字节码，JVM通过逐条解释字节码将其翻译成对应的机器指令，逐条读入，逐条解释翻译，  
执行速度必然比C/C++编译后的可执行二进制字节码程序慢，为了提高执行速度，就引入了JIT技术，JIT会在运行时分析应用程序的代码，  
识别哪些方法可以归类为热方法，这些方法会被JIT编译器编译成对应的汇编代码，然后存储到代码缓存中，以后调用这些方法时就不用解释执行了，  
可以直接使用代码缓存中已编译好的汇编代码。这能显著提升应用程序的执行效率。  
安卓Dalvik虚拟机在2.2中增加了JIT，相对的AOT就是指C/C++这类语言，编译器在编译时直接将程序源码编译成目标机器码，运行时直接运行机器码。  

